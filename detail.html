<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>대회 상세 - See&YOU</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark" style="background: #4a90e2;">
    <div class="container">
      <a class="navbar-brand fw-bold" href="index.html">
        <i class="bi bi-trophy me-2"></i>See&YOU
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item">
            <a class="nav-link" href="index.html">
              <i class="bi bi-house me-1"></i>Home
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">
              <i class="bi bi-plus-circle me-1"></i>대회 올리기
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="mypage.html">
              <i class="bi bi-person-circle me-1"></i>마이페이지
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" href="detail.html">
              <i class="bi bi-search me-1"></i>대회 탐색
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="calendar.html">
              <i class="bi bi-calendar3 me-1"></i>캘린더
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <main class="container my-4" id="dynamic-detail">
    <!-- JS로 대회정보 동적으로 표시될 영역 -->
    <div class="text-center mb-4">
      <div id="contest-image"></div>
    </div>
    <div class="detail-info" id="contest-info">
      <div class="d-flex justify-content-center my-4">
        <div id="loading" class="text-secondary">대회 정보를 불러오는 중...</div>
      </div>
    </div>
  </main>
  <footer>
    <p>제작자: 충남대학교 컴퓨터융합학부 전유정</p>
  </footer>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
  // detail.html?page=title용 fetch/파싱/DOM 업데이트
  document.addEventListener('DOMContentLoaded', function() {
    function getQueryParam(key){
      const params = new URLSearchParams(window.location.search);
      return params.get(key);
    }
    const title = getQueryParam('title');
    const $info = document.getElementById('contest-info');
    const $img = document.getElementById('contest-image');
    const $loading = document.getElementById('loading');
    if (!title) {
      $info.innerHTML = '<div class="alert alert-warning">대회명을 찾을 수 없습니다.</div>';
      $img.innerHTML = '';
      return;
    }
    fetch('contests.txt')
    .then(res => res.text())
    .then(txt => {
      const lines = txt.split('\n').filter(line => !!line.trim());
      let found = false;
      for(const line of lines) {
        const [name, period, roles, contact] = line.split(' | ');
        if(name && name.trim() === decodeURIComponent(title)) {
          found = true;
          // 이미지 이름 convention(없으면 기본이미지): images/{title_key}.png
          const titleKey = name.trim().replace(/\s/g,'_').replace(/[^a-zA-Z0-9_]/g,'');
          $img.innerHTML = `<img src="images/${titleKey}.png" alt="${name} 대표 이미지" class="img-fluid rounded" style="max-width:400px;">`;
          $info.innerHTML = `
            <h2 class="mb-3">${name}</h2>
            <table class="table my-4">
              <tr><th>모집 기간</th><td colspan="2">${period || '-'}</td></tr>
              <tr><th>필요 역할</th><td colspan="2">${roles || '-'}</td></tr>
              <tr><th>연락처</th><td colspan="2">${contact || '-'}</td></tr>
            </table>
            <button class="btn btn-primary mb-2">대회 신청</button>
          `;
          break;
        }
      }
      if (!found) {
        $info.innerHTML = '<div class="alert alert-danger">해당 대회를 찾을 수 없습니다.</div>';
        $img.innerHTML = '';
      }
    }).catch(e => {
      $info.innerHTML = '<div class="alert alert-danger">대회 정보 파일을 불러올 수 없습니다.</div>';
      $img.innerHTML = '';
    });
  });
  </script>
</body>
</html>
